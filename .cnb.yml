master:
  push:
    - services:
        - docker
      docker:
        image: cnbcool/default-build-env:latest
        #volumes缓存：https://docs.cnb.cool/zh/grammar/pipeline.html#volumes
        volumes:
          # 使用缓存，同时更新
          - /root/
      stages:
        - name: docker login
          script:
            - docker login -u ${CNB_TOKEN_USER_NAME} -p "${CNB_TOKEN}" ${CNB_DOCKER_REGISTRY}
        - name: 构建:php74-fpm-nginx
          script:
            - cd ./php/7.4/fpm-alpine-nginx
            - docker build -t ${CNB_DOCKER_REGISTRY}/php127/docker/php:7.4.33-fpm-alpine-nginx .
            - docker push ${CNB_DOCKER_REGISTRY}/php127/docker/php:7.4.33-fpm-alpine-nginx
        - name: 构建:php74-fpm
          script:
            - cd ./php/7.4/fpm-alpine
            - docker build -t ${CNB_DOCKER_REGISTRY}/php127/docker/php:7.4.33-fpm-alpine .
            - docker push ${CNB_DOCKER_REGISTRY}/php127/docker/php:7.4.33-fpm-alpine
        - name: 构建:php74-cli
          script:
            - cd ./php/7.4/cli-alpine
            - docker build -t ${CNB_DOCKER_REGISTRY}/php127/docker/php:7.4.33-cli-alpine .
            - docker push ${CNB_DOCKER_REGISTRY}/php127/docker/php:7.4.33-cli-alpine
        - name: 构建:php74-cli-cron
          script:
            - cd ./php/7.4/cli-alpine/cron
            - docker build -t ${CNB_DOCKER_REGISTRY}/php127/docker/php:7.4.33-cli-alpine-cron .
            - docker push ${CNB_DOCKER_REGISTRY}/php127/docker/php:7.4.33-cli-alpine-cron
        - name: 构建:php74-cli-supervisord
          script:
            - cd ./php/7.4/cli-alpine/supervisord
            - docker build -t ${CNB_DOCKER_REGISTRY}/php127/docker/php:7.4.33-cli-alpine-supervisord .
            - docker push ${CNB_DOCKER_REGISTRY}/php127/docker/php:7.4.33-cli-alpine-supervisord
        - name: 构建:php78-cli
          script:
            - cd ./php/8.4/cli-alpine
            - docker build -t ${CNB_DOCKER_REGISTRY}/php127/docker/php:7.4-cli-alpine .
            - docker push ${CNB_DOCKER_REGISTRY}/php127/docker/php:7.4-cli-alpine
      